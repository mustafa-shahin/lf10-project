{% extends "base.html" %} {% block title %}Dashboard{% endblock %} {% block
content %}


{% if user.person_type == "admin" %}
  <h1>Benutzer</h1>
  {% else %}
  <h1>Anträge</h1>
  <table>
    <tr>
      <th>Antrag</th>
      <th>Typ</th>
      <th>Höhe</th>
      <th>Term</th>
      <th>Status</th>
      <th>Erstelldatum</th>
      <th>Entscheidungsdatum</th>
      <th>Dateien</th>
      {% if user.person_type == "employee" %}
      <th>Aktionen</th>
      {% endif %}
    </tr>
  
    {% for app in applications %}
    <tr>
      <td>{{ app.loan_type }}</td>
      <td>{{ app.loan_subtype }}</td>
      <td>{{ app.requested_amount }}</td>
      <td>{{ app.term_in_years }}</td>
      <td>{{ app.status }}</td>
    <td>
      {% if app.created_at %}
        {{ app.created_at.strftime("%Y-%m-%d") }}
      {% endif %}
    </td>

    <td>
      {% if app.decided_at %}
        {{ app.decided_at.strftime("%Y-%m-%d") }}

      {% endif %}
    </td>
      <td>
        {% if app.files %}
        <ul class="margin-0">
          {% for f in app.files %}
          <li>
            <a href="/download/{{ f.id }}">{{ f.file_name }}</a>
          </li>
          {% endfor %}
        </ul>
        {% else %} No Files {% endif %}
      </td>
  
      {% if user.person_type == "employee" %}
      <td>
        <!-- Accept Form -->
        <form method="POST" action="/dashboard/decision" style="display: inline">
          <input type="hidden" name="application_id" value="{{ app.id }}" />
          <input type="hidden" name="decision" value="accept" />
          <button class="btn">Annehmen</button>
        </form>
  
        <form method="POST" action="/dashboard/decision" style="display: inline">
          <input type="hidden" name="application_id" value="{{ app.id }}" />
          <input type="hidden" name="decision" value="reject" />
          <button class="btn">Ablehnen</button>
        </form>
      </td>
      {% endif %}
    </tr>
    {% endfor %}
  </table>
{% endif %}



{% if user.person_type == "customer" %}
<p>
  <a class="btn" href="/loan">Einen Kreditantrag erstellen</a>
</p>
{% endif %} 
{% if user.person_type == "admin" %}
<h2>Benutzer Verwaltung</h2>
<table>
  <tr>
    <th>ID</th>
    <th>Name</th>
    <th>Email</th>
    <th>Type</th>
    <th>Action</th>
  </tr>
  {% for u in users %}
  <tr>
    <td>{{ u.id }}</td>
    <td>{{ u.first_name }} {{ u.second_name }}</td>
    <td>{{ u.email }}</td>
    <td>
        <form class="flex user-management" method="POST" action="/dashboard/update-user">
          <input type="hidden" name="user_id" value="{{ u.id }}" />
          <select name="person_type">
            <option value="customer" {% if u.person_type == "customer" %}selected{% endif %}>Customer</option>
            <option value="employee" {% if u.person_type == "employee" %}selected{% endif %}>Employee</option>
            <option value="admin" {% if u.person_type == "admin" %}selected{% endif %}>Admin</option>
          </select>
          <button class="btn" type="submit">Update</button>        
        </form>    
    </td>
  </tr>
  {% endfor %}
</table>
{% endif %}

{% endblock %}
